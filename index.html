<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Configuração de Link</title>
    
    <!-- Link para o Manifesto (Necessário para instalar como App) -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Ícone para iOS (Opcional, mas recomendado) -->
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2983/2983818.png">
    <meta name="theme-color" content="#1a73e8">

    <style>
      /* Estilos básicos para parecer um App limpo */
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f0f2f5;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        color: #333;
        user-select: none; /* Melhora a sensação de App nativo */
      }

      .card {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        width: 90%;
        max-width: 400px;
        text-align: center;
      }

      h2 { margin-top: 0; color: #1a73e8; }
      p { color: #666; margin-bottom: 20px; }

      input[type="text"] {
        width: 100%;
        padding: 12px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-sizing: border-box; 
        font-size: 16px;
      }

      button {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.2s;
        margin-bottom: 10px;
      }

      .btn-primary { background-color: #1a73e8; color: white; }
      .btn-primary:hover { background-color: #1557b0; }

      .btn-secondary { background-color: #e8f0fe; color: #1a73e8; }
      .btn-secondary:hover { background-color: #d2e3fc; }

      .hidden { display: none; }
      
      .error-msg { color: red; font-size: 0.9em; display: none; margin-bottom: 10px;}
    </style>
  </head>
  <body>

    <div class="card">
      
      <!-- TELA 1: Configuração (se não tiver link salvo) -->
      <div id="setupScreen">
        <h2>Bem-vindo</h2>
        <p>Você ainda não configurou seu link pessoal.</p>
        
        <input type="text" id="userLinkInput" placeholder="Ex: https://meusite.com">
        <div id="errorMsg" class="error-msg">Por favor, insira um link válido.</div>
        
        <button class="btn-primary" onclick="salvarLink()">Salvar Link</button>
      </div>

      <!-- TELA 2: Acesso (se já tiver link salvo) -->
      <div id="accessScreen" class="hidden">
        <h2>Seu Acesso</h2>
        <p>Seu link pessoal está pronto.</p>
        
        <button class="btn-primary" onclick="irParaLink()">Acessar Agora</button>
        <button class="btn-secondary" onclick="resetarLink()">Configurar Novo Link</button>
      </div>

    </div>

    <script>
      // Chave para salvar no navegador do usuário
      const STORAGE_KEY = 'meu_link_pessoal_v1';

      // Elementos do DOM
      const setupScreen = document.getElementById('setupScreen');
      const accessScreen = document.getElementById('accessScreen');
      const inputLink = document.getElementById('userLinkInput');
      const errorMsg = document.getElementById('errorMsg');

      // Ao carregar a página
      window.onload = function() {
        // 1. Verifica lógica do link
        const linkSalvo = localStorage.getItem(STORAGE_KEY);
        if (linkSalvo && linkSalvo.length > 0) {
          mostrarTelaAcesso();
        } else {
          mostrarTelaConfig();
        }

        // 2. Registra o Service Worker (PWA)
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('./sw.js')
            .then(reg => console.log('SW registrado!', reg))
            .catch(err => console.log('Erro no SW:', err));
        }
      };

      function salvarLink() {
        let url = inputLink.value.trim();

        if (!url) {
          mostrarErro("O campo não pode estar vazio.");
          return;
        }

        if (!url.startsWith('http://') && !url.startsWith('https://')) {
          url = 'https://' + url;
        }

        localStorage.setItem(STORAGE_KEY, url);
        mostrarTelaAcesso();
      }

      function irParaLink() {
        const url = localStorage.getItem(STORAGE_KEY);
        if (url) {
          window.location.href = url;
        } else {
          resetarLink();
        }
      }

      function resetarLink() {
        localStorage.removeItem(STORAGE_KEY);
        inputLink.value = ""; 
        mostrarTelaConfig();
      }

      // Funções de UI
      function mostrarTelaAcesso() {
        setupScreen.classList.add('hidden');
        accessScreen.classList.remove('hidden');
        errorMsg.style.display = 'none';
      }

      function mostrarTelaConfig() {
        accessScreen.classList.add('hidden');
        setupScreen.classList.remove('hidden');
      }
      
      function mostrarErro(msg) {
        errorMsg.textContent = msg;
        errorMsg.style.display = 'block';
      }
    </script>
  </body>
</html>
